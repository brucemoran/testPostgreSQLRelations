/*
 * ----------------------------------------------------------
 *  Nextflow config file for Genome HPC cluster (PBS/Torque)
 * ----------------------------------------------------------
 * Imported under the 'genome' Nextflow profile in:
 * nextflow.config
 */

params {

  sampleCsv = null
  bamCsv = null
  refDir = null
  help = false
  runID = "somatic_n-of-1"
  assembly = "GRCh37"
  incOrder = null
  germline = false
  seqLevel = "WGS"
  exomeTag = null
  scatGath = null
  sampleCat = null
  multiqcConfig = "$baseDir/assets/somatic_n-of-1.multiQC_config.yaml"
  cosmic = false
  localPCGRdata = null
  phylogeny = false
  microbiome = false
  germOnly = false

  //Hartwig GRIDSS refs
  hartwigGPLURL37 = 'https://nextcloud.hartwigmedicalfoundation.nl/s/LTiKTd8XxBqwaiC/download?path=%2FHMFTools-Resources%2FGRIDSS-Purple-Linx-Docker/gpl_ref_data_37.gz'

  hartwigGPLURL38 = 'https://nextcloud.hartwigmedicalfoundation.nl/s/LTiKTd8XxBqwaiC/download?path=%2FHMFTools-Resources%2FGRIDSS-Purple-Linx-Docker/gpl_ref_data_38.gz'

  //PCGR data bundles
  pcgrURL37 = 'http://insilico.hpc.uio.no/pcgr/pcgr.databundle.grch37.20201123.tgz'
  pcgrURL38 = 'http://insilico.hpc.uio.no/pcgr/pcgr.databundle.grch38.20201123.tgz'

  genomes {
      'GRCh37' {
          fa     = "${params.refDir}/${params.assembly}/bwa/human_g1k_v37.noChr.fasta"
          fai     = "${params.refDir}/${params.assembly}/bwa/human_g1k_v37.noChr.fasta.fai"
          dict   = "${params.refDir}/${params.assembly}/bwa/human_g1k_v37.noChr.dict"
          bwa    = "${params.refDir}/${params.assembly}/bwa"
          hc_dbs = "${params.refDir}/${params.assembly}/hc_dbs"
          dbsnp  = "${params.refDir}/${params.assembly}/dbsnp"
          gridss = "${params.refDir}/${params.assembly}/gridss"
          pcgr   = "${params.refDir}/${params.assembly}/pcgr"
          exome  = "${params.refDir}/${params.assembly}/exome"
          wgs    = "${params.refDir}/${params.assembly}/wgs"
          cosmic = "${params.refDir}/${params.assembly}/cosmic/cancer_gene_census.bed"
          refflat = "${params.refDir}/${params.assembly}/refflat/refFlat.GRCh37.txt"
    }
  }
}

process {

  executor = 'pbs'
  cache = 'lenient'
  time = '48.h'

  container = 'library://bruce.moran/default/projects:somatic_n-of-1.centos7.mamba'

  withLabel:low_mem {
    cpus = 2
    memory = 4.GB
  }

  withLabel:med_mem {
    cpus = 5
    memory = 16.GB
  }

  withLabel:high_mem {
    cpus = 10
    memory = 32.GB
  }

  withLabel:max_mem {
    cpus = 20
    memory = 64.GB
  }

}

singularity {

  enabled = true
  cacheDir = '/data/genome/bmoran/singularity/nextflow'
  runOptions = '--bind /data/genome/bmoran:/data/genome/bmoran'

}

timeline {
  enabled = true
  file = "pipeline_info/somatic_n-of-1.timeline.html"
}

report {
  enabled = true
  file = "pipeline_info/somatic_n-of-1.report.html"
}

trace {
  enabled = true
  file = "pipeline_info/somatic_n-of-1.trace.txt"
}

dag {
  enabled = true
  file = "pipeline_info/somatic_n-of-1.dag.svg"
}
